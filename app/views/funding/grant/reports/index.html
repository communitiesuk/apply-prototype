{% extends "layouts/reports.html" %}

{% set navID = 'grantReports' %}
{% set showBackLink = false %}

{% set pageSize = "l" %}
{% set pageHeading = "Reports" %}
{% set pageSection = '' + data['grantName'] + '' %}
{% set pageHiddentext = "yes" %}
{% set pageNested = "yes" %}

{% block pageTitle %}{{ macroPageTitle.pageTitle(pageHeading) }}{% endblock %}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-two-thirds">
                
                {{ macroPageHeader.pageHeader(pageNested,pageHeading,pageSection,pageHiddentext,pageSize) }}
                
                {% if not data.reports or data.reports.length == 0 %}                                    
                    <p class="govuk-body">There are no monitoring reports for {{ data.grantName or "NAME of GRANT" }}. Add a monitoring report to get started.</p>
                    <p class="govuk-body"><a href="#">See an example of a monitoring report form</a> and a description of the component parts of a form.</p>
                {% else %}
                    <p class="govuk-body"><a href="#">See an example of a monitoring report form</a> and a description of the component parts of a form.</p>
                {% endif %}                
        
                <form method="post" action="/funding/grant/reports/add/">
                    {% set buttonText = "Add a monitoring report" %}
                    {% if data.reports and data.reports.length > 0 %}
                        {% set buttonText = "Add another monitoring report" %}
                    {% endif %}
                    {{ govukButton({
                        text: buttonText,
                        classes: "govuk-!-margin-top-5"
                    }) }}
                </form>
            </div>
        </div>
    
        {% if data.reports and data.reports.length > 0 %}
      
            {% for report in data.reports %}
                {% if report.sections %}
                    {% set sectionCount = report.sections.length %}
                {% else %}
                    {% set sectionCount = 0 %}
                {% endif %}
                
                {% if sectionCount == 0 %}
 {% set sectionsText = '<a href="/funding/grant/reports/add/section/?reportId=' + report.id + '" class="govuk-link govuk-link--no-visited-state">Add sections</a> to start creating your report' %}
 {% set sectionsRow = {
 key: { text: "Sections" },
 value: { html: sectionsText }
 } %}
 {% elif sectionCount == 1 %}
 {% set sectionsText = '<a href="/funding/grant/reports/sections?reportId=' + report.id + '" class="govuk-link govuk-link--no-visited-state">' + sectionCount|string + ' section</a>' %}
 {% set sectionsList = '<ul class="govuk-list">' %}
 {% for section in report.sections %}
 {% set sectionsList = sectionsList + '<li>' + section.sectionName + '</li>' %}
 {% endfor %}
 {% set sectionsList = sectionsList + '</ul>' %}
 {% set sectionsRow = {
 key: { text: "Sections" },
 value: { html: sectionsText + '<br>' + sectionsList },
 actions: {
 items: [
 { href: "/funding/grant/reports/add/section/?reportId=" + report.id,
 classes: "govuk-link govuk-link--no-visited-state",
 text: "Add another section",
 visuallyHiddenText: "to report"
 }
 ]
 }
 } %}
 {% else %}
 {% set sectionsText = '<a href="/funding/grant/reports/sections?reportId=' + report.id + '" class="govuk-link govuk-link--no-visited-state">' + sectionCount|string + ' sections</a>' %}
 {% set sectionsList = '<ul class="govuk-list">' %}
 {% for section in report.sections %}
 {% set sectionsList = sectionsList + '<li>' + section.sectionName + '</li>' %}
 {% endfor %}
 {% set sectionsList = sectionsList + '</ul>' %}
 {% set sectionsRow = {
 key: { text: "Sections" },
 value: { html: sectionsText + '<br>' + sectionsList },
 actions: {
 items: [
 {
 href: "/funding/grant/reports/add/section/?reportId=" + report.id,
 classes: "govuk-link govuk-link--no-visited-state",
 text: "Add another section",
 visuallyHiddenText: "to report"
 }
 ]
 }
 } %}
 {% endif %}
 
                {{ govukSummaryList({
                    card: {
                        title: { text: report.reportName or "Form name" },
                        classes: "govuk-!-margin-top-7 govuk-!-margin-bottom-7",
                        actions: {
                            items: [
                                {
                                    href: "#",
                                    classes: "govuk-link govuk-link--no-visited-state",
                                    text: "Preview",
                                    visuallyHiddenText: "report"
                                },
                                {
                                    href: "#",
                                    classes: "govuk-link govuk-link--no-visited-state",
                                    text: "Change name",
                                    visuallyHiddenText: "of report"
                                },
                                {
                                    href: "/funding/grant/reports/delete/" + report.id,
                                    classes: "govuk-link govuk-link--no-visited-state govuk-link--destructive",
                                    text: "Delete",
                                    visuallyHiddenText: "report"
                                }
                            ]
                        }
                    },
                    rows: [
                        {
                            key: { text: "Created by" },
                            value: { html: '<a href="#">' + report.createdBy + '</a> on ' + report.createdDate }
                        },
                        {
                            key: { text: "Last updated" },
                            value: { html: '<a href="#">' + report.updatedBy + '</a> on ' + report.lastUpdated }
                        },
                        sectionsRow
                    ]
                }) }}
                
               
                
            {% endfor %}

        {% endif %}
    
        {% if data['liveReports'] == "yes" %}
            {% include "/includes/reports/live.html" %}
        {% endif %}

    </div>
</div>
{% endblock %}